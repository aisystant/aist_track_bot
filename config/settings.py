"""
–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞.

–í—Å–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã, —Ç–æ–∫–µ–Ω—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ–±—Ä–∞–Ω—ã –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ.
"""

import os
import logging
from datetime import timedelta, timezone
from pathlib import Path

# ============= –¢–û–ö–ï–ù–´ –ò –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø =============

BOT_TOKEN = os.getenv("TELEGRAM_BOT_TOKEN")
ANTHROPIC_API_KEY = os.getenv("ANTHROPIC_API_KEY")
DATABASE_URL = os.getenv("DATABASE_URL")
MCP_URL = os.getenv("MCP_URL", "https://guides-mcp.aisystant.workers.dev/mcp")
KNOWLEDGE_MCP_URL = os.getenv("KNOWLEDGE_MCP_URL", "https://knowledge-mcp.aisystant.workers.dev/mcp")

def validate_env():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è"""
    if not BOT_TOKEN:
        raise ValueError("TELEGRAM_BOT_TOKEN –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
    if not ANTHROPIC_API_KEY:
        raise ValueError("ANTHROPIC_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")
    if not DATABASE_URL:
        raise ValueError("DATABASE_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω!")

# ============= –õ–û–ì–ò–†–û–í–ê–ù–ò–ï =============

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)

def get_logger(name: str) -> logging.Logger:
    """–ü–æ–ª—É—á–∏—Ç—å –ª–æ–≥–≥–µ—Ä –¥–ª—è –º–æ–¥—É–ª—è"""
    return logging.getLogger(name)

# ============= –í–†–ï–ú–ï–ù–ù–ê–Ø –ó–û–ù–ê =============

MOSCOW_TZ = timezone(timedelta(hours=3))

# ============= –ü–£–¢–ò –ö –§–ê–ô–õ–ê–ú =============

BASE_DIR = Path(__file__).parent.parent
TOPICS_DIR = BASE_DIR / "topics"
KNOWLEDGE_STRUCTURE_PATH = BASE_DIR / "knowledge_structure.yaml"

# ============= –†–ï–ñ–ò–ú–´ –†–ê–ë–û–¢–´ =============

class Mode:
    """–†–µ–∂–∏–º—ã —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞"""
    MARATHON = "marathon"
    FEED = "feed"
    BOTH = "both"

# ============= –°–¢–ê–¢–£–°–´ =============

class MarathonStatus:
    """–°—Ç–∞—Ç—É—Å—ã –º–∞—Ä–∞—Ñ–æ–Ω–∞"""
    NOT_STARTED = "not_started"
    ACTIVE = "active"
    PAUSED = "paused"
    COMPLETED = "completed"

class FeedStatus:
    """–°—Ç–∞—Ç—É—Å—ã –ª–µ–Ω—Ç—ã"""
    NOT_STARTED = "not_started"
    ACTIVE = "active"
    PAUSED = "paused"

class FeedWeekStatus:
    """–°—Ç–∞—Ç—É—Å—ã –Ω–µ–¥–µ–ª–∏ –ª–µ–Ω—Ç—ã"""
    PLANNING = "planning"
    ACTIVE = "active"
    COMPLETED = "completed"

# ============= –£–†–û–í–ù–ò –°–õ–û–ñ–ù–û–°–¢–ò =============

DIFFICULTY_LEVELS = {
    "easy": {"emoji": "üå±", "name": "–ù–∞—á–∞–ª—å–Ω—ã–π", "desc": "–° –Ω—É–ª—è, –ø—Ä–æ—Å—Ç—ã–º —è–∑—ã–∫–æ–º"},
    "medium": {"emoji": "üåø", "name": "–°—Ä–µ–¥–Ω–∏–π", "desc": "–ï—Å—Ç—å –±–∞–∑–æ–≤—ã–µ –∑–Ω–∞–Ω–∏—è"},
    "hard": {"emoji": "üå≥", "name": "–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π", "desc": "–ì–ª—É–±–æ–∫–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ"}
}

LEARNING_STYLES = {
    "theoretical": {"emoji": "üìö", "name": "–¢–µ–æ—Ä–µ—Ç–∏–∫", "desc": "–°–Ω–∞—á–∞–ª–∞ —Ç–µ–æ—Ä–∏—è, –ø–æ—Ç–æ–º –ø—Ä–∞–∫—Ç–∏–∫–∞"},
    "practical": {"emoji": "üîß", "name": "–ü—Ä–∞–∫—Ç–∏–∫", "desc": "–£—á—É—Å—å –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö –∏ –∑–∞–¥–∞—á–∞—Ö"},
    "mixed": {"emoji": "‚öñÔ∏è", "name": "–°–º–µ—à–∞–Ω–Ω—ã–π", "desc": "–ë–∞–ª–∞–Ω—Å —Ç–µ–æ—Ä–∏–∏ –∏ –ø—Ä–∞–∫—Ç–∏–∫–∏"}
}

EXPERIENCE_LEVELS = {
    "student": {"emoji": "üéì", "name": "–°—Ç—É–¥–µ–Ω—Ç", "desc": "–£—á—É—Å—å –∏–ª–∏ –Ω–µ–¥–∞–≤–Ω–æ –∑–∞–∫–æ–Ω—á–∏–ª"},
    "junior": {"emoji": "üå±", "name": "Junior", "desc": "0-2 –≥–æ–¥–∞ –æ–ø—ã—Ç–∞"},
    "middle": {"emoji": "üíº", "name": "Middle", "desc": "2-5 –ª–µ—Ç –æ–ø—ã—Ç–∞"},
    "senior": {"emoji": "‚≠ê", "name": "Senior", "desc": "5+ –ª–µ—Ç –æ–ø—ã—Ç–∞"},
    "switching": {"emoji": "üîÑ", "name": "–ú–µ–Ω—è—é —Å—Ñ–µ—Ä—É", "desc": "–ü–µ—Ä–µ—Ö–æ–∂—É –∏–∑ –¥—Ä—É–≥–æ–π –æ–±–ª–∞—Å—Ç–∏"}
}

STUDY_DURATIONS = {
    "5": {"emoji": "‚ö°", "name": "5 –º–∏–Ω—É—Ç", "words": 500, "desc": "–ë—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä"},
    "10": {"emoji": "üïê", "name": "10 –º–∏–Ω—É—Ç", "words": 1000, "desc": "–ö—Ä–∞—Ç–∫–æ–µ –∏–∑—É—á–µ–Ω–∏–µ"},
    "15": {"emoji": "üïë", "name": "15 –º–∏–Ω—É—Ç", "words": 1500, "desc": "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ"},
    "20": {"emoji": "üïí", "name": "20 –º–∏–Ω—É—Ç", "words": 2000, "desc": "–£–≥–ª—É–±–ª—ë–Ω–Ω–æ–µ –∏–∑—É—á–µ–Ω–∏–µ"},
    "25": {"emoji": "üïì", "name": "25 –º–∏–Ω—É—Ç", "words": 2500, "desc": "–ü–æ–ª–Ω–æ–µ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ"}
}

# ============= –£–†–û–í–ù–ò –°–õ–û–ñ–ù–û–°–¢–ò (–±—ã–≤—à. Bloom) =============

COMPLEXITY_LEVELS = {
    1: {
        "emoji": "üîµ",
        "name": "–†–∞–∑–ª–∏—á–µ–Ω–∏—è",
        "short_name": "–°–ª–æ–∂–Ω–æ—Å—Ç—å-1",
        "desc": "–†–∞–∑–ª–∏—á–µ–Ω–∏–µ –∏ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –ø–æ–Ω—è—Ç–∏–π",
        "question_type": "–í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É {concept} –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –ø–æ–Ω—è—Ç–∏—è–º–∏?",
        "prompt": "–°–æ–∑–¥–∞–π –≤–æ–ø—Ä–æ—Å –Ω–∞ –†–ê–ó–õ–ò–ß–ï–ù–ò–ï –ø–æ–Ω—è—Ç–∏–π. –ü–æ–ø—Ä–æ—Å–∏ –æ–±—ä—è—Å–Ω–∏—Ç—å, –≤ —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –∫–æ–Ω—Ü–µ–ø—Ü–∏—è–º–∏, —á–µ–º –æ—Ç–ª–∏—á–∞—é—Ç—Å—è –ø–æ–¥—Ö–æ–¥—ã."
    },
    2: {
        "emoji": "üü°",
        "name": "–ü–æ–Ω–∏–º–∞–Ω–∏–µ",
        "short_name": "–°–ª–æ–∂–Ω–æ—Å—Ç—å-2",
        "desc": "–û—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ",
        "question_type": "–ö–∞–∫ –≤—ã –ø–æ–Ω–∏–º–∞–µ—Ç–µ {concept}? –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?",
        "prompt": "–°–æ–∑–¥–∞–π –û–¢–ö–†–´–¢–´–ô –≤–æ–ø—Ä–æ—Å –Ω–∞ –ø–æ–Ω–∏–º–∞–Ω–∏–µ. –ü–æ–ø—Ä–æ—Å–∏ –æ–±—ä—è—Å–Ω–∏—Ç—å —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, —Ä–∞—Å–∫—Ä—ã—Ç—å —Å–≤—è–∑–∏ –º–µ–∂–¥—É –ø–æ–Ω—è—Ç–∏—è–º–∏, –æ–±—ä—è—Å–Ω–∏—Ç—å –ø–æ—á–µ–º—É —á—Ç–æ-—Ç–æ –≤–∞–∂–Ω–æ."
    },
    3: {
        "emoji": "üî¥",
        "name": "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ",
        "short_name": "–°–ª–æ–∂–Ω–æ—Å—Ç—å-3",
        "desc": "–ê–Ω–∞–ª–∏–∑ –∏ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏",
        "question_type": "–ü—Ä–∏–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä {concept} –∏–∑ –≤–∞—à–µ–π –∂–∏–∑–Ω–∏ –∏–ª–∏ —Ä–∞–±–æ—Ç—ã. –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é.",
        "prompt": "–°–æ–∑–¥–∞–π –≤–æ–ø—Ä–æ—Å –Ω–∞ –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –∏ –ê–ù–ê–õ–ò–ó. –ü–æ–ø—Ä–æ—Å–∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–∑ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏ –∏–ª–∏ —Ä–∞–±–æ—á–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏, –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏—é, –æ–±—ä—è—Å–Ω–∏—Ç—å –∫–æ–ª–ª–µ–≥–µ."
    }
}

# –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
BLOOM_LEVELS = COMPLEXITY_LEVELS

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è: –ø–æ—Å–ª–µ N —Ç–µ–º –Ω–∞ —Ç–µ–∫—É—â–µ–º —É—Ä–æ–≤–Ω–µ
COMPLEXITY_AUTO_UPGRADE_AFTER = 7
BLOOM_AUTO_UPGRADE_AFTER = COMPLEXITY_AUTO_UPGRADE_AFTER  # –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏

# ============= –õ–ò–ú–ò–¢–´ –ú–ê–†–ê–§–û–ù–ê =============

# PRODUCTION VALUES (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):
# DAILY_TOPICS_LIMIT = 2
# MAX_TOPICS_PER_DAY = 4
DAILY_TOPICS_LIMIT = 999  # –í–†–ï–ú–ï–ù–ù–û: –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
MAX_TOPICS_PER_DAY = 999  # –í–†–ï–ú–ï–ù–ù–û: –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

MARATHON_DAYS = 14  # –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–∞—Ä–∞—Ñ–æ–Ω–∞

# ============= –ù–ê–°–¢–†–û–ô–ö–ò –õ–ï–ù–¢–´ =============

FEED_DAYS_PER_WEEK = 7  # —Å–µ—Å—Å–∏–π –≤ –Ω–µ–¥–µ–ª—é
FEED_SESSION_DURATION_MIN = 5  # –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ (–º–∏–Ω)
FEED_SESSION_DURATION_MAX = 12  # –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏ (–º–∏–Ω)
FEED_TOPICS_TO_SUGGEST = 5  # —Å–∫–æ–ª—å–∫–æ —Ç–µ–º –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –Ω–∞ –≤—ã–±–æ—Ä

# ============= –ù–ê–°–¢–†–û–ô–ö–ò –ò–ù–¢–ï–ù–¢–û–í =============

QUESTION_WORDS = ['—á—Ç–æ', '–∫–∞–∫', '–ø–æ—á–µ–º—É', '–∑–∞—á–µ–º', '–∫–æ–≥–¥–∞', '–≥–¥–µ', '–∫—Ç–æ', '–∫–∞–∫–æ–π', '–º–æ–∂–Ω–æ –ª–∏', '—á–µ–º']
TOPIC_REQUEST_PATTERNS = ['—Ö–æ—á—É', '–¥–∞–≤–∞–π', '–ø—Ä–µ–¥–ª–æ–∂–∏', '—Ç–µ–º–∞']
COMMAND_WORDS = {
    '–ø—Ä–æ—â–µ': 'simpler',
    '–≥–ª—É–±–∂–µ': 'deeper',
    '–ø—Ä–∏–º–µ—Ä—ã': 'examples',
    '–¥–∞–ª—å—à–µ': 'next',
    '–ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å': 'skip',
}

# ============= –ö–ê–¢–ï–ì–û–†–ò–ò –†–ê–ë–û–ß–ò–• –ü–†–û–î–£–ö–¢–û–í =============

WORK_PRODUCT_CATEGORIES = {
    'diagnosis': '–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞',
    'tracker': '—Ç—Ä–µ–∫–µ—Ä',
    'hypothesis': '–≥–∏–ø–æ—Ç–µ–∑–∞',
    'checklist': '—á–µ–∫-–ª–∏—Å—Ç',
    'meme_transform': '—Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –º–µ–º–æ–≤',
    'schema': '—Å—Ö–µ–º–∞',
    'plan': '–ø–ª–∞–Ω',
    'fixation': '—Ñ–∏–∫—Å–∞—Ü–∏—è',
}
