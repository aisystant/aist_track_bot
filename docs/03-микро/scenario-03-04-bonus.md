# 03.04 –°—Ü–µ–Ω–∞—Ä–∏–π –±–æ–Ω—É—Å–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

> –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –ø–æ–≤—ã—à–µ–Ω–Ω–æ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏.

---

## –û–±–∑–æ—Ä

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ö–æ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è | –ü–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ —É—Ä–æ–∫ |
| –£—Å–ª–æ–≤–∏–µ | –°–ª–æ–∂–Ω–æ—Å—Ç—å < 3 |
| –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ù–µ—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |

---

## 1. –ö–æ–≥–¥–∞ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –±–æ–Ω—É—Å

### –£—Å–ª–æ–≤–∏–µ

```python
if intern['complexity_level'] < 3:
    # –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –±–æ–Ω—É—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å
```

| –¢–µ–∫—É—â–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å | –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –±–æ–Ω—É—Å? | –£—Ä–æ–≤–µ–Ω—å –±–æ–Ω—É—Å–∞ |
|-------------------|---------------------|----------------|
| 1 | –î–∞ | 2 |
| 2 | –î–∞ | 3 |
| 3 | –ù–µ—Ç | ‚Äî |

---

## 2. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

```
[–£—á–µ–Ω–∏–∫]                              [–ë–æ—Ç]

–û—Ç–≤–µ—Ç –Ω–∞ —É—Ä–æ–∫ (‚â•20 —Å–∏–º–≤.) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ –°–ª—É–∂–µ–±–Ω–æ–µ: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                                      "‚úÖ –¢–µ–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"

                                      [–ï—Å–ª–∏ –°–ª–æ–∂–Ω–æ—Å—Ç—å < 3]
                                      –í–æ–ø—Ä–æ—Å: –ë–æ–Ω—É—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å
                                      "üöÄ –•–æ—Ç–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ—Å–ª–æ–∂–Ω–µ–µ?"
                                      "–≠—Ç–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ ‚Äî –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å."

                                      [–î–∞, —Ö–æ—á—É!] [–ù–µ—Ç, —Å–ø–∞—Å–∏–±–æ]

[–í–∞—Ä–∏–∞–Ω—Ç –ê: "–î–∞, —Ö–æ—á—É!"] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ –°–ª—É–∂–µ–±–Ω–æ–µ: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                                      "–ì–µ–Ω–µ—Ä–∏—Ä—É—é –≤–æ–ø—Ä–æ—Å..."
                                      ‚Üì
                                      –í–æ–ø—Ä–æ—Å: –ë–æ–Ω—É—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å
                                      "üéØ –í–æ–ø—Ä–æ—Å (–°–ª–æ–∂–Ω–æ—Å—Ç—å-{N+1}):"
                                      "{—Å–ª–æ–∂–Ω—ã–π –≤–æ–ø—Ä–æ—Å}"
                                      FSM: waiting_for_bonus_answer

–û—Ç–≤–µ—Ç –Ω–∞ –±–æ–Ω—É—Å (‚â•20 —Å–∏–º–≤.) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ –°–ª—É–∂–µ–±–Ω–æ–µ: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
                                      "‚úÖ –û—Ç–ª–∏—á–Ω–æ! –ë–æ–Ω—É—Å –∑–∞—Å—á–∏—Ç–∞–Ω."
                                      "–í—ã —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç–µ –Ω–∞–≤—ã–∫ –∞–Ω–∞–ª–∏–∑–∞."

                                      [–î–∞–ª–µ–µ: –º–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–¥–∞–Ω–∏—è]

[–í–∞—Ä–∏–∞–Ω—Ç –ë: "–ù–µ—Ç, —Å–ø–∞—Å–∏–±–æ"] ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ [–î–∞–ª–µ–µ: –º–∞—Ç–µ—Ä–∏–∞–ª –∑–∞–¥–∞–Ω–∏—è]
```

---

## 3. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –±–æ–Ω—É—Å–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

### –£—Ä–æ–≤–µ–Ω—å –≤–æ–ø—Ä–æ—Å–∞

```python
next_level = min(intern['complexity_level'] + 1, 3)
question = await claude.generate_question(topic, intern, bloom_level=next_level)
```

### –¢–∏–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —É—Ä–æ–≤–Ω—é

| –£—Ä–æ–≤–µ–Ω—å | –¢–∏–ø –≤–æ–ø—Ä–æ—Å–∞ | –ü—Ä–∏–º–µ—Ä |
|---------|-------------|--------|
| 1 | –†–∞–∑–ª–∏—á–µ–Ω–∏–µ | "–í —á—ë–º —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É X –∏ Y?" |
| 2 | –ü–æ–Ω–∏–º–∞–Ω–∏–µ | "–ü–æ—á–µ–º—É X –≤–∞–∂–µ–Ω –¥–ª—è Y?" |
| 3 | –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ | "–ü—Ä–∏–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä X –∏–∑ –≤–∞—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏" |

---

## 4. FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è

```python
class LearningStates(StatesGroup):
    waiting_for_answer = State()        # –û—Ç–≤–µ—Ç –Ω–∞ —É—Ä–æ–∫
    waiting_for_work_product = State()  # –ù–∞–∑–≤–∞–Ω–∏–µ –†–ü
    waiting_for_bonus_answer = State()  # –û—Ç–≤–µ—Ç –Ω–∞ –±–æ–Ω—É—Å
```

---

## 5. –°–æ—Ö—Ä–∞–Ω—è–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ

### –ü—Ä–∏ –æ—Ç–≤–µ—Ç–µ –Ω–∞ –±–æ–Ω—É—Å

**–¢–∞–±–ª–∏—Ü–∞ `answers`:**
```sql
INSERT INTO answers (
    chat_id, topic_index, answer, answer_type, mode
) VALUES (
    123456, 0, '[BONUS] –ú–æ–π –∞–Ω–∞–ª–∏–∑...', 'bonus_answer', 'marathon'
)
```

### –ß—Ç–æ –ù–ï –º–µ–Ω—è–µ—Ç—Å—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|----------|-----------|
| `completed_topics` | –ù–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è |
| `topics_today` | –ù–µ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è |
| `complexity_level` | –ù–µ –ø–æ–≤—ã—à–∞–µ—Ç—Å—è |
| `active_days` | –ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è |

---

## 6. –í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ |
|----------|----------|
| –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ | 20 —Å–∏–º–≤–æ–ª–æ–≤ |
| –ü—Ä–∏ –æ—à–∏–±–∫–µ | "–ù–∞–ø–∏—à–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ (—Ö–æ—Ç—è –±—ã 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)" |

---

## 7. Callbacks

| Callback | –î–µ–π—Å—Ç–≤–∏–µ |
|----------|----------|
| `bonus_yes` | –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å –±–æ–Ω—É—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å |
| `bonus_no` | –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –ø–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–¥–∞–Ω–∏—é |

---

## 8. –°–æ–æ–±—â–µ–Ω–∏—è

### –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –±–æ–Ω—É—Å–∞

```
‚úÖ *–¢–µ–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!*

üöÄ *–•–æ—Ç–∏—Ç–µ –≤–æ–ø—Ä–æ—Å –ø–æ—Å–ª–æ–∂–Ω–µ–µ?*

–≠—Ç–æ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –º—ã—à–ª–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –≤—ã—à–µ.
–ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å –º–∞—Ä–∞—Ñ–æ–Ω–∞.

[–î–∞, —Ö–æ—á—É!] [–ù–µ—Ç, —Å–ø–∞—Å–∏–±–æ]
```

### –ë–æ–Ω—É—Å–Ω—ã–π –≤–æ–ø—Ä–æ—Å

```
üéØ *–í–æ–ø—Ä–æ—Å (–°–ª–æ–∂–Ω–æ—Å—Ç—å-3):*

–ü—Ä–∏–≤–µ–¥–∏—Ç–µ –ø—Ä–∏–º–µ—Ä –∏–∑ –≤–∞—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–∏, –∫–æ–≥–¥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ "—Ñ–ª—é–≥–µ—Ä–∞"
–º–µ—à–∞–ª–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—é —Ü–µ–ª–∏. –ö–∞–∫ –±—ã –≤—ã –ø—Ä–∏–º–µ–Ω–∏–ª–∏ –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ–±—Ä–∞–Ω–Ω–æ—Å—Ç–∏?
```

### –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç

```
‚úÖ *–û—Ç–ª–∏—á–Ω–æ!*

–ë–æ–Ω—É—Å –∑–∞—Å—á–∏—Ç–∞–Ω. –í—ã —Ç—Ä–µ–Ω–∏—Ä—É–µ—Ç–µ –Ω–∞–≤—ã–∫ –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞.

/learn ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å (–∑–∞–¥–∞–Ω–∏–µ)
```

---

## 9. –î–∏–∞–≥—Ä–∞–º–º–∞

```
on_answer (–æ—Ç–≤–µ—Ç –Ω–∞ —É—Ä–æ–∫)
    ‚Üì
complexity_level < 3?
    ‚îú‚îÄ –î–ê ‚Üí –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ [–î–∞] [–ù–µ—Ç]
    ‚îÇ       ‚îú‚îÄ bonus_yes ‚Üí generate_question(level+1)
    ‚îÇ       ‚îÇ            ‚Üì FSM: waiting_for_bonus_answer
    ‚îÇ       ‚îÇ            ‚Üì on_bonus_answer
    ‚îÇ       ‚îÇ            ‚Üì save_answer("[BONUS] ...")
    ‚îÇ       ‚îÇ            ‚Üì ‚Üí –ó–∞–¥–∞–Ω–∏–µ
    ‚îÇ       ‚îÇ
    ‚îÇ       ‚îî‚îÄ bonus_no ‚Üí –ó–∞–¥–∞–Ω–∏–µ
    ‚îÇ
    ‚îî‚îÄ –ù–ï–¢ ‚Üí –ó–∞–¥–∞–Ω–∏–µ
```

---

## 10. –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –°—Ç—Ä–æ–∫–∏ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|--------|-----------|
| `bot.py` | 2377-2434 | on_bonus_yes |
| `bot.py` | 2436-2448 | on_bonus_no |
| `bot.py` | 2450-2499 | on_bonus_answer |
| `clients/claude.py` | 273+ | generate_question |

---

## –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –î–∞—Ç–∞ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| 2026-01-22 | –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞ |
