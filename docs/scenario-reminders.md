# Ğ¡Ñ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹

> ĞŸĞ¾Ğ»Ğ½Ğ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ° Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ñ… ÑƒĞ²ĞµĞ´Ğ¾Ğ¼Ğ»ĞµĞ½Ğ¸Ğ¹.

---

## ĞĞ±Ğ·Ğ¾Ñ€

| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| Ğ¢Ğ¸Ğ¿Ñ‹ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹ | +1Ñ‡, +3Ñ‡ |
| ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº | APScheduler |
| Ğ§Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ | ĞœĞ¾ÑĞºĞ²Ğ° (UTC+3) |
| Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ | ĞšĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ |

---

## 1. Ğ¢Ğ¸Ğ¿Ñ‹ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹

### ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· 1 Ñ‡Ğ°Ñ (+1h)

```
â° *ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ*

Ğ”ĞµĞ½ÑŒ {N} Ğ¼Ğ°Ñ€Ğ°Ñ„Ğ¾Ğ½Ğ° Ğ¶Ğ´Ñ‘Ñ‚ Ğ²Ğ°Ñ!

Ğ’ÑĞµĞ³Ğ¾ 2 Ñ‚ĞµĞ¼Ñ‹ Ğ½Ğ° ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ: ÑƒÑ€Ğ¾Ğº Ğ¸ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ.

/learn â€” Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ
```

### ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ Ñ‡ĞµÑ€ĞµĞ· 3 Ñ‡Ğ°ÑĞ° (+3h)

```
ğŸ”” *ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ*

Ğ”ĞµĞ½ÑŒ {N} ĞµÑ‰Ñ‘ Ğ½Ğµ Ğ½Ğ°Ñ‡Ğ°Ñ‚.

ĞŸĞ¾Ğ¼Ğ½Ğ¸Ñ‚Ğµ: *Ñ€ĞµĞ³ÑƒĞ»ÑÑ€Ğ½Ğ¾ÑÑ‚ÑŒ > Ğ¸Ğ½Ñ‚ĞµĞ½ÑĞ¸Ğ²Ğ½Ğ¾ÑÑ‚ÑŒ*.
Ğ”Ğ°Ğ¶Ğµ 15 Ğ¼Ğ¸Ğ½ÑƒÑ‚ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ â€” ÑÑ‚Ğ¾ Ğ¿Ñ€Ğ¾Ğ³Ñ€ĞµÑÑ.

/learn â€” Ğ½Ğ°Ñ‡Ğ°Ñ‚ÑŒ
```

---

## 2. Ğ–Ğ¸Ğ·Ğ½ĞµĞ½Ğ½Ñ‹Ğ¹ Ñ†Ğ¸ĞºĞ» Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ

### Ğ”Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ‚ĞµĞ¼Ñ‹ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ                       â”‚
â”‚    send_scheduled_topic(chat_id, bot)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹                         â”‚
â”‚    schedule_reminders(chat_id, intern)              â”‚
â”‚                                                     â”‚
â”‚    DELETE ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ½ĞµĞ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ                     â”‚
â”‚    INSERT +1h (now + 1 Ñ‡Ğ°Ñ)                         â”‚
â”‚    INSERT +3h (now + 3 Ñ‡Ğ°ÑĞ°)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ (scheduler Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ)    â”‚
â”‚    scheduled_check() â†’ check_reminders()            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Ğ’Ñ€ĞµĞ¼Ñ Ğ¿Ñ€Ğ¸ÑˆĞ»Ğ¾: scheduled_for <= now              â”‚
â”‚                                                     â”‚
â”‚    SELECT * FROM reminders                          â”‚
â”‚    WHERE sent = FALSE AND scheduled_for <= now      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹                                 â”‚
â”‚                                                     â”‚
â”‚    topics_today > 0? â†’ ĞĞ• Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ               â”‚
â”‚    marathon_day == 0? â†’ ĞĞ• Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑÑ‚ÑŒ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ğ¸ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ                            â”‚
â”‚                                                     â”‚
â”‚    send_reminder(chat_id, reminder_type)            â”‚
â”‚    UPDATE sent = TRUE                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸

### ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ ĞĞ• Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ, ĞµÑĞ»Ğ¸:

| Ğ£ÑĞ»Ğ¾Ğ²Ğ¸Ğµ | ĞŸÑ€Ğ¸Ñ‡Ğ¸Ğ½Ğ° |
|---------|---------|
| `topics_today > 0` | Ğ£Ñ‡ĞµĞ½Ğ¸Ğº ÑƒĞ¶Ğµ Ğ½Ğ°Ñ‡Ğ°Ğ» Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞµĞ³Ğ¾Ğ´Ğ½Ñ |
| `marathon_day == 0` | ĞœĞ°Ñ€Ğ°Ñ„Ğ¾Ğ½ ĞµÑ‰Ñ‘ Ğ½Ğµ Ğ½Ğ°Ñ‡Ğ°Ğ»ÑÑ |

### Ğ›Ğ¾Ğ³Ğ¸ĞºĞ° Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸

```python
async def send_reminder(chat_id, reminder_type, bot):
    intern = await get_intern(chat_id)
    topics_today = get_topics_today(intern)

    # Ğ•ÑĞ»Ğ¸ ÑƒĞ¶Ğµ Ğ½Ğ°Ñ‡Ğ°Ğ» â€” Ğ½Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°ĞµĞ¼
    if topics_today > 0:
        return

    marathon_day = get_marathon_day(intern)
    if marathon_day == 0:
        return

    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ
    ...
```

---

## 4. Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° reminders

### Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ°

```sql
CREATE TABLE reminders (
    id SERIAL PRIMARY KEY,
    chat_id BIGINT,
    reminder_type TEXT,        -- '+1h' Ğ¸Ğ»Ğ¸ '+3h'
    scheduled_for TIMESTAMP,   -- Ğ’Ñ€ĞµĞ¼Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
    sent BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT NOW()
)
```

### ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹

| id | chat_id | reminder_type | scheduled_for | sent |
|----|---------|---------------|---------------|------|
| 1 | 123456 | +1h | 2026-01-22 10:00 | FALSE |
| 2 | 123456 | +3h | 2026-01-22 12:00 | FALSE |
| 3 | 789012 | +1h | 2026-01-22 15:00 | TRUE |

---

## 5. Ğ¤ÑƒĞ½ĞºÑ†Ğ¸Ğ¸

### schedule_reminders()

```python
async def schedule_reminders(chat_id: int, intern: dict):
    """ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€ÑƒĞµÑ‚ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ"""
    now = moscow_now()

    async with db_pool.acquire() as conn:
        # Ğ£Ğ´Ğ°Ğ»ÑĞµĞ¼ ÑÑ‚Ğ°Ñ€Ñ‹Ğµ Ğ½ĞµĞ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ
        await conn.execute(
            'DELETE FROM reminders WHERE chat_id = $1 AND sent = FALSE',
            chat_id
        )

        # Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ğ¼ Ğ½Ğ¾Ğ²Ñ‹Ğµ +1h Ğ¸ +3h
        for hours in [1, 3]:
            reminder_time = now + timedelta(hours=hours)
            # Ğ£Ğ±Ğ¸Ñ€Ğ°ĞµĞ¼ timezone Ğ´Ğ»Ñ TIMESTAMP Ğ±ĞµĞ· timezone
            reminder_time_naive = reminder_time.replace(tzinfo=None)
            await conn.execute(
                '''INSERT INTO reminders (chat_id, reminder_type, scheduled_for)
                   VALUES ($1, $2, $3)''',
                chat_id, f'+{hours}h', reminder_time_naive
            )
```

### check_reminders()

```python
async def check_reminders():
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚ Ğ¸ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµÑ‚ Ğ·Ğ°Ğ¿Ğ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ"""
    now = moscow_now()
    now_naive = now.replace(tzinfo=None)

    async with db_pool.acquire() as conn:
        # ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ Ğº Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ
        rows = await conn.fetch(
            '''SELECT id, chat_id, reminder_type FROM reminders
               WHERE sent = FALSE AND scheduled_for <= $1''',
            now_naive
        )

        for row in rows:
            try:
                await send_reminder(row['chat_id'], row['reminder_type'], bot)
                await conn.execute(
                    'UPDATE reminders SET sent = TRUE WHERE id = $1',
                    row['id']
                )
            except Exception as e:
                logger.error(f"Failed to send reminder: {e}")
```

### scheduled_check()

```python
async def scheduled_check():
    """ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ ĞºĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ"""
    now = moscow_now()
    time_str = f"{now.hour:02d}:{now.minute:02d}"

    # ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ° Ñ‚ĞµĞ¼ Ğ¿Ğ¾ Ñ€Ğ°ÑĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ñ
    chat_ids = await get_all_scheduled_interns(now.hour, now.minute)
    for chat_id in chat_ids:
        await send_scheduled_topic(chat_id, bot)

    # ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹
    await check_reminders()
```

---

## 6. ĞŸĞ»Ğ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº

### Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ

```python
from apscheduler.schedulers.asyncio import AsyncIOScheduler

scheduler = AsyncIOScheduler(timezone=MOSCOW_TZ)
scheduler.add_job(scheduled_check, 'cron', minute='*')  # ĞšĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ
scheduler.start()
```

### ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€Ñ‹

| ĞŸĞ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ | Ğ—Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|----------|----------|
| Ğ‘Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ° | APScheduler |
| Ğ¢Ğ¸Ğ¿ | AsyncIOScheduler |
| Ğ¢Ñ€Ğ¸Ğ³Ğ³ĞµÑ€ | CronTrigger |
| Ğ§Ğ°ÑÑ‚Ğ¾Ñ‚Ğ° | ĞšĞ°Ğ¶Ğ´ÑƒÑ Ğ¼Ğ¸Ğ½ÑƒÑ‚Ñƒ (`minute='*'`) |
| Timezone | Moscow (UTC+3) |

---

## 7. Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ

```python
# ĞšĞ°Ğ¶Ğ´Ñ‹Ğµ 10 Ğ¼Ğ¸Ğ½ÑƒÑ‚ (Ğ¿Ğ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‹)
logger.info(f"[Scheduler] ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ² {time_str} MSK")

# ĞŸÑ€Ğ¸ ÑƒÑĞ¿ĞµÑˆĞ½Ğ¾Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ
logger.info(f"Sent {reminder_type} reminder to {chat_id}")

# ĞŸÑ€Ğ¸ Ğ¾ÑˆĞ¸Ğ±ĞºĞµ
logger.error(f"Failed to send reminder to {chat_id}: {e}")
```

---

## 8. Ğ’Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ°Ñ ÑˆĞºĞ°Ğ»Ğ° Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ğ°

```
09:00  Ğ£Ñ‡ĞµĞ½Ğ¸Ğº Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ‚ĞµĞ¼Ñƒ (schedule_time)
       â†’ schedule_reminders() ÑĞ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚:
         - +1h: 10:00
         - +3h: 12:00

10:00  check_reminders() Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ +1h
       â†’ topics_today == 0? Ğ”Ğ
       â†’ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ "â° ĞĞ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ"
       â†’ UPDATE sent = TRUE

12:00  check_reminders() Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ +3h
       â†’ topics_today == 0? Ğ”Ğ
       â†’ ĞÑ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ "ğŸ”” ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğµ"
       â†’ UPDATE sent = TRUE

---

ĞĞ»ÑŒÑ‚ĞµÑ€Ğ½Ğ°Ñ‚Ğ¸Ğ²Ğ½Ñ‹Ğ¹ ÑÑ†ĞµĞ½Ğ°Ñ€Ğ¸Ğ¹:

09:00  Ğ£Ñ‡ĞµĞ½Ğ¸Ğº Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ñ‚ĞµĞ¼Ñƒ
10:00  Ğ£Ñ‡ĞµĞ½Ğ¸Ğº Ğ¿Ñ€Ğ¾Ñ…Ğ¾Ğ´Ğ¸Ñ‚ ÑƒÑ€Ğ¾Ğº (topics_today = 1)
10:01  check_reminders() Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ +1h
       â†’ topics_today > 0? Ğ”Ğ
       â†’ ĞĞ• Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼ (ÑƒÑ‡ĞµĞ½Ğ¸Ğº ÑƒĞ¶Ğµ Ğ°ĞºÑ‚Ğ¸Ğ²ĞµĞ½)

12:00  check_reminders() Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ñ‚ +3h
       â†’ topics_today > 0? Ğ”Ğ
       â†’ ĞĞ• Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ÑĞµĞ¼
```

---

## 9. ĞÑĞ¾Ğ±ĞµĞ½Ğ½Ğ¾ÑÑ‚Ğ¸

### Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ğ°Ñ€Ñ‹Ñ… Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹

ĞŸÑ€Ğ¸ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞµ Ğ½Ğ¾Ğ²Ğ¾Ğ¹ Ñ‚ĞµĞ¼Ñ‹ Ğ²ÑĞµ **Ğ½ĞµĞ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ½Ñ‹Ğµ** Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ ÑƒĞ´Ğ°Ğ»ÑÑÑ‚ÑÑ Ğ¿ĞµÑ€ĞµĞ´ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸ĞµĞ¼ Ğ½Ğ¾Ğ²Ñ‹Ñ….

### Ğ§Ğ°ÑĞ¾Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾ÑÑ

Ğ’ÑĞµ Ñ€Ğ°ÑÑ‡Ñ‘Ñ‚Ñ‹ Ğ¸ Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒÑÑ‚ Ğ¼Ğ¾ÑĞºĞ¾Ğ²ÑĞºĞ¾Ğµ Ğ²Ñ€ĞµĞ¼Ñ (UTC+3). TIMESTAMP Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑÑ Ğ±ĞµĞ· timezone.

### Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼Ğ¾ÑÑ‚ÑŒ

Ğ›ĞµĞ³ĞºĞ¾ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ½Ğ¾Ğ²Ñ‹Ğµ Ñ‚Ğ¸Ğ¿Ñ‹ Ğ½Ğ°Ğ¿Ğ¾Ğ¼Ğ¸Ğ½Ğ°Ğ½Ğ¸Ğ¹:
```python
for hours in [1, 3, 5, 24]:  # Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ +5h Ğ¸ +24h
    ...
```

---

## 10. ĞšĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹

| Ğ¤Ğ°Ğ¹Ğ» | Ğ¡Ñ‚Ñ€Ğ¾ĞºĞ¸ | ĞĞ°Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ |
|------|--------|-----------|
| `bot.py` | 2893-2914 | schedule_reminders() |
| `bot.py` | 2917-2948 | send_reminder() |
| `bot.py` | 2951-2981 | check_reminders() |
| `bot.py` | 2984-3007 | scheduled_check() |
| `bot.py` | 3181-3182 | Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ scheduler |
| `db/models.py` | 162-173 | Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ° reminders |

---

## Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹

| Ğ”Ğ°Ñ‚Ğ° | Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ |
|------|-----------|
| 2026-01-22 | Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ´Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ° |
